window.noshahiData = {
  cities: [
    "Lahore", "Faisalabad", "Rawalpindi", "Multan", "Gujranwala", "Sargodha",
    "Bahawalpur", "Sahiwal", "Sheikhupura", "Rahim Yar Khan", "Jhang", "Dera Ghazi Khan",
    "Gujrat", "Sialkot", "Mianwali", "Kasur", "Okara", "Chiniot", "Khanewal",
    "Muzaffargarh", "Vehari", "Bahawalnagar", "Pakpattan", "Layyah", "Lodhran",
    "Bhakkar", "Narowal", "Attock", "Khushab", "Mandi Bahauddin", "Nankana Sahib",
    "Hafizabad", "Rajanpur", "Jhelum", "Chakwal", "Toba Tek Singh", "Wazirabad",
    "Kamoke", "Arifwala", "Burewala", "Muridke", "Sadiqabad", "Khanpur", "Pattoki",
    "Jaranwala", "Samundri", "Mian Channu", "Shakargarh", "Kot Addu", "Ahmedpur East",
    "Jalalpur Jattan", "Taxila", "Talagang", "Chishtian", "Karachi"
  ],
  punjabAreas: {
    "Lahore": ["DHA", "Bahria Town", "Johar Town", "Model Town", "Gulberg", "Wapda Town"],
    "Faisalabad": ["Madina Town", "Gulberg", "Canal Road", "Peoples Colony", "Satiana Road", "Susan Road"],
    "Rawalpindi": ["Bahria Town", "DHA", "Saddar", "Chaklala Scheme", "Adiala Road", "Peshawar Road"],
    "Multan": ["Cantt", "Bosan Road", "DHA", "Askari", "Gulgasht Colony", "Shah Rukn-e-Alam"],
    "Gujranwala": ["DC Colony", "Citi Housing", "Peoples Colony", "Wapda Town", "Model Town", "Satellite Town"],
    "Sargodha": ["Satellite Town", "University Road", "49 Tail", "Liaqatabad", "Fatima Jinnah Road", "New Satellite Town"],
    "Bahawalpur": ["Model Town A", "Model Town B", "Satellite Town", "Yazman Road", "Hasilpur Road", "Circular Road"],
    "Sahiwal": ["Farid Town", "Canal View", "Noor Shah Road", "High Street", "Old Civil Lines", "Scheme No 3"],
    "Sheikhupura": ["Housing Colony", "Canal View", "Jinnah Park", "Civil Lines", "Lahore Road", "Sargodha Road"],
    "Rahim Yar Khan": ["Satellite Town", "Model Town", "Aminabad", "Shahi Road", "Khanpur Road", "Airport Road"],
    "Jhang": ["Satellite Town", "Civil Lines", "Yousaf Shah Road", "Shah Jewna", "Chenab Nagar Road", "College Road"],
    "Dera Ghazi Khan": ["Sakhi Sarwar Road", "Model Town", "College Road", "Fort Munro Road", "Jampur Road", "Block C"],
    "Gujrat": ["Bhimber Road", "Jalalpur Jattan Road", "Service Mor", "Shadman Colony", "Railway Road", "Circular Road"],
    "Sialkot": ["Cantt", "Paris Road", "Model Town", "Defence Road", "Kashmir Road", "Hajipura"],
    "Mianwali": ["Kalabagh Road", "Chashma Road", "City Housing", "Musa Khel", "College Chowk", "Civil Lines"],
    "Kasur": ["Kot Radha Kishan Road", "Model Town", "Bulleh Shah Colony", "Ganda Singh Road", "Circular Road", "Kacha Pakka"],
    "Okara": ["Renala Khurd Road", "Depalpur Road", "Green Town", "Model Town", "Canal Colony", "Mianwali Road"],
    "Chiniot": ["Satellite Town", "Lalian Road", "Civil Lines", "Jhang Road", "Kunjah Road", "College Road"],
    "Khanewal": ["Kabirwala Road", "College Colony", "City Housing", "Model Town", "Mian Channu Road", "Niazi Chowk"],
    "Muzaffargarh": ["Model Town", "Khangarh Road", "Alipur Road", "Civil Lines", "Dera Adda", "College Road"],
    "Vehari": ["Burewala Road", "Model Town", "Club Road", "College Town", "12 Block", "Daniwal"],
    "Bahawalnagar": ["Haroonabad Road", "Chishtian Road", "Model Town", "Satellite Town", "Circular Road", "Azeem Town"],
    "Pakpattan": ["Arifwala Road", "Dipalpur Road", "Farid Nagar", "Canal View", "College Road", "Adda Malka Hans"],
    "Layyah": ["Chobara Road", "Karor Road", "Model Town", "Canal Colony", "College Road", "Civil Lines"],
    "Lodhran": ["Dunyapur Road", "Kahror Pacca Road", "Model Town", "Bahawalpur Road", "College Chowk", "Canal View"],
    "Bhakkar": ["Mankera Road", "Darya Khan Road", "Model Town", "Civil Lines", "Jhang Road", "Kallur Kot Road"],
    "Narowal": ["Shakargarh Road", "Zafarwal Road", "Islam Pura", "Model Town", "Circular Road", "College Road"],
    "Attock": ["Camp Area", "Pindi Gheb Road", "Kamra Road", "Jand Road", "Civil Lines", "Hazro Road"],
    "Khushab": ["Jauharabad", "Quaidabad Road", "Noorpur Thal Road", "Model Town", "Civil Lines", "Satellite Town"],
    "Mandi Bahauddin": ["Phalia Road", "Malakwal Road", "College Road", "Civil Lines", "Model Town", "Canal Colony"],
    "Nankana Sahib": ["Sangla Hill Road", "Shahkot Road", "Railway Road", "Model Town", "Canal Colony", "Chak 5"],
    "Hafizabad": ["Gujranwala Road", "Sukheki Road", "Model Town", "Jalalpur Road", "Canal View", "College Road"],
    "Rajanpur": ["Jampur Road", "Model Town", "Indus Highway", "Fazilpur Road", "Civil Lines", "Canal Colony"],
    "Jhelum": ["Cantt", "Civil Lines", "Kala Gujran", "GT Road", "Model Town", "Sarai Alamgir Road"],
    "Chakwal": ["Talagang Road", "Bhoun Road", "Civil Lines", "Model Town", "College Road", "Kallar Kahar Road"],
    "Toba Tek Singh": ["Rajana Road", "Gojra Road", "Model Town", "Civil Lines", "Canal View", "College Road"],
    "Wazirabad": ["Sialkot Road", "Gujranwala Road", "Railway Road", "Model Town", "Allahabad Road", "Civil Lines"],
    "Kamoke": ["GT Road", "Sialkot Bypass", "Model Town", "Canal View", "Civil Lines", "Mandiala Road"],
    "Arifwala": ["Quaid-e-Azam Road", "Pakpattan Road", "Model Town", "Farid Colony", "Canal View", "College Road"],
    "Burewala": ["Vehari Road", "Model Town", "College Town", "Canal View", "Ghalla Mandi", "Sharqi Colony"],
    "Muridke": ["GT Road", "Narowal Road", "Service Road", "Model Town", "Sadat Colony", "Canal View"],
    "Sadiqabad": ["KLP Road", "Factory Area", "Satellite Town", "Model Town", "Canal Colony", "Old City"],
    "Khanpur": ["Rahim Yar Khan Road", "Model Town", "Cantt", "Canal View", "Basti Aman", "Jinnah Colony"],
    "Pattoki": ["Multan Road", "Habibabad", "Model Town", "Canal Colony", "Railway Road", "Civil Lines"],
    "Jaranwala": ["Satiana Road", "Lahore Road", "Model Town", "Civil Lines", "Canal Colony", "Iqbal Park"],
    "Samundri": ["Faisalabad Road", "Ghalla Mandi", "Model Town", "Civil Lines", "Railway Road", "Canal View"],
    "Mian Channu": ["Khanewal Road", "Talamba Road", "Model Town", "Civil Lines", "Railway Colony", "Canal View"],
    "Shakargarh": ["Narowal Road", "Zafarwal Road", "Model Town", "City Center", "Civil Lines", "Adda Bazar"],
    "Kot Addu": ["Muzaffargarh Road", "Power Plant Road", "Model Town", "Canal Colony", "Civil Lines", "Main Bazar"],
    "Ahmedpur East": ["Bahawalpur Road", "Model Town", "Canal Colony", "Civil Lines", "College Road", "City Center"],
    "Jalalpur Jattan": ["Gujrat Road", "Circular Road", "Model Town", "Civil Lines", "Main Bazar", "College Road"],
    "Taxila": ["GT Road", "Heavy Mechanical Complex", "Wah Cantt Border", "Model Town", "Civil Lines", "University Road"],
    "Talagang": ["Chakwal Road", "Main Bazar", "Model Town", "Civil Lines", "Lawa Road", "Jhatla Road"],
    "Chishtian": ["Bahawalnagar Road", "Model Town", "Satellite Town", "Civil Lines", "Railway Road", "Farid Colony"]
  },
  properties: [
    { id: 1, title: "10 Marla Modern House", city: "Lahore", area: "DHA", type: "House", intent: "Buy", price: 52000000, beds: 5, baths: 6, featured: true, status: "approved" },
    { id: 2, title: "5 Marla Rental Home", city: "Lahore", area: "Johar Town", type: "House", intent: "Rent", price: 120000, beds: 3, baths: 3, featured: false, status: "approved" },
    { id: 3, title: "1 Kanal Plot", city: "Multan", area: "DHA", type: "Plot", intent: "Buy", price: 25000000, beds: 0, baths: 0, featured: true, status: "approved" },
    { id: 4, title: "Commercial Shop", city: "Gujranwala", area: "DC Colony", type: "Commercial", intent: "Buy", price: 18000000, beds: 0, baths: 1, featured: false, status: "approved" },
    { id: 5, title: "Luxury Apartment", city: "Sialkot", area: "Cantt", type: "Apartment", intent: "Rent", price: 250000, beds: 3, baths: 3, featured: true, status: "approved" },
    { id: 6, title: "8 Marla Corner House", city: "Rawalpindi", area: "Bahria Town", type: "House", intent: "Buy", price: 32000000, beds: 4, baths: 4, featured: false, status: "approved" }
  ],
  projects: [
    { name: "Marina Blue Karachi", city: "Karachi", units: "850+", image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
    { name: "Noshahi Residencia", city: "Lahore", units: "400+" },
    { name: "Central Heights", city: "Faisalabad", units: "220+" },
    { name: "South Villas", city: "Multan", units: "180+" },
    { name: "Canal Vista Enclave", city: "Rawalpindi", units: "300+" },
    { name: "Green Palm Residency", city: "Gujranwala", units: "260+" }
  ],
  blogs: [
    {
      id: 1,
      title: "How to verify property documents in Pakistan",
      author: "Team Noshahi",
      category: "Legal Guide",
      date: "2026-01-12",
      readTime: "5 min read",
      content: "Before buying any property, verify ownership records, approved society status, and encumbrance history. Always check official land records, request a complete transfer chain, and match seller CNIC details with ownership documents. For safer transactions, involve a licensed legal advisor and avoid cash-only undocumented payments."
    },
    {
      id: 2,
      title: "Buy vs Rent: 2026 practical guide",
      author: "Market Desk",
      category: "Buyer Guide",
      date: "2026-01-21",
      readTime: "4 min read",
      content: "Buying is stronger for long-term stability and equity building, while renting offers flexibility and lower upfront cost. Compare monthly rent-to-income ratio, expected appreciation, and maintenance burden in your target city. If your stay horizon is short, rent is usually safer; for long-term living, buying can be more efficient."
    },
    {
      id: 3,
      title: "Top investment zones this year",
      author: "Research Team",
      category: "Market Trends",
      date: "2026-02-05",
      readTime: "6 min read",
      content: "Strong investment zones usually combine infrastructure growth, high rental demand, and transparent development approvals. Focus on areas near transit corridors, commercial hubs, and expanding residential clusters. Diversify across city tiers instead of concentrating capital in a single micro-market."
    }
  ],
  leads: [
    "Ali Raza asked for site visit in DHA Lahore",
    "Hina wants rent options in Faisalabad",
    "Saad requested callback for Gujranwala shop"
  ]
};

window.noshahiStore = {
  key: "noshahi_custom_listings",
  getCustomListings() {
    try {
      return JSON.parse(localStorage.getItem(this.key) || "[]");
    } catch {
      return [];
    }
  },
  setCustomListings(items) {
    localStorage.setItem(this.key, JSON.stringify(items));
  },
  allListings() {
    return [...window.noshahiData.properties, ...this.getCustomListings()];
  },
  getCart() {
    try {
      return JSON.parse(localStorage.getItem("noshahi_cart") || "[]");
    } catch {
      return [];
    }
  },
  addToCart(id) {
    const cart = this.getCart();
    if (!cart.includes(id)) {
      cart.push(id);
      localStorage.setItem("noshahi_cart", JSON.stringify(cart));
      return true;
    }
    return false;
  },
  clearCart() {
    localStorage.removeItem("noshahi_cart");
  },
  // User & Auth Logic
  getUsers() {
    try {
      return JSON.parse(localStorage.getItem("noshahi_users") || "[]");
    } catch {
      return [];
    }
  },
  saveUser(user) {
    const users = this.getUsers();
    users.push(user);
    localStorage.setItem("noshahi_users", JSON.stringify(users));
  },
  updateUser(updatedUser) {
    const users = this.getUsers();
    const idx = users.findIndex(u => u.email === updatedUser.email);
    if (idx >= 0) {
      users[idx] = updatedUser;
      localStorage.setItem("noshahi_users", JSON.stringify(users));
    }
  },
  getCurrentUser() {
    try {
      return JSON.parse(localStorage.getItem("noshahi_session") || "null");
    } catch {
      return null;
    }
  },
  login(email, password) {
    // Admin Hardcoded Check
    if (email === "admin@noshahi.pk" && password === "admin123") {
      const admin = { name: "System Admin", email, role: "admin" };
      localStorage.setItem("noshahi_session", JSON.stringify(admin));
      return { success: true, user: admin };
    }

    const users = this.getUsers();
    const user = users.find(u => u.email === email && u.password === password);
    if (user) {
      localStorage.setItem("noshahi_session", JSON.stringify(user));
      return { success: true, user };
    }
    return { success: false, message: "Invalid email or password" };
  },
  // Lead Management
  getLeads() {
    try {
      return JSON.parse(localStorage.getItem("noshahi_leads") || "[]");
    } catch {
      return [];
    }
  },
  saveLead(lead) {
    const leads = this.getLeads();
    leads.push({ id: Date.now(), timestamp: new Date().toISOString(), status: "new", ...lead });
    localStorage.setItem("noshahi_leads", JSON.stringify(leads));
  },
  updateLead(updatedLead) {
    const leads = this.getLeads();
    const idx = leads.findIndex(l => l.id === updatedLead.id);
    if (idx >= 0) {
      leads[idx] = updatedLead;
      localStorage.setItem("noshahi_leads", JSON.stringify(leads));
    }
  },
  // View Tracking (Simulated)
  incrementView(id) {
    const views = JSON.parse(localStorage.getItem("noshahi_views") || "{}");
    views[id] = (views[id] || 0) + 1;
    localStorage.setItem("noshahi_views", JSON.stringify(views));
  },
  getViews(id) {
    const views = JSON.parse(localStorage.getItem("noshahi_views") || "{}");
    return views[id] || 0;
  },
  logout() {
    localStorage.removeItem("noshahi_session");
    window.location.href = "login.html";
  }
};

window.noshahiAlert = function (title, message, type = 'success') {
  // Remove existing if any
  const old = document.getElementById('noshahi-custom-alert');
  if (old) old.remove();

  let icon = 'fa-circle-exclamation text-warning';
  if (type === 'success') icon = 'fa-circle-check text-success';
  if (type === 'info') icon = 'fa-circle-info text-primary';

  const alertHtml = `
    <div id="noshahi-custom-alert" class="modal fade show" style="display: block; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1060;">
      <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
          <div class="modal-body text-center p-5">
            <i class="fa-solid ${icon} fa-4x mb-4"></i>
            <h3 class="h4 mb-2 fw-bold text-dark">${title}</h3>
            <p class="text-muted mb-4">${message}</p>
            <button class="btn btn-primary w-100 py-3 rounded-pill fw-bold" onclick="document.getElementById('noshahi-custom-alert').remove()">Got it!</button>
          </div>
        </div>
      </div>
    </div>
  `;

  document.body.insertAdjacentHTML('beforeend', alertHtml);
};
